package com.com.xodos

import android.app.Application
import android.content.Context
import android.os.Process
import android.util.Log

class XodosApplication : Application() {
    
    companion object {
        var isAppLaunchedByUser = false
        var appStartTime: Long = 0
    }
    
    override fun onCreate() {
        super.onCreate()
        appStartTime = System.currentTimeMillis()
        
        // Log how we were started
        val stackTrace = Thread.currentThread().stackTrace
        val isLikelySystemCall = stackTrace.any {
            it.className.contains("ActivityManager") ||
            it.className.contains("PackageManager") ||
            it.methodName.contains("getApplicationInfo") ||
            it.methodName.contains("queryIntentActivities")
        }
        
        isAppLaunchedByUser = !isLikelySystemCall
        
        Log.d("XodosApplication", 
            "App created. Launched by user: $isAppLaunchedByUser, " +
            "StackTrace: ${stackTrace.joinToString("\n") { it.methodName }}")
    }
    
    override fun onTrimMemory(level: Int) {
        super.onTrimMemory(level)
        // Clean up heavy resources when system is under memory pressure
        if (level >= TRIM_MEMORY_UI_HIDDEN) {
            // Tell Flutter/Dart side to release heavy resources
            Log.d("XodosApplication", "Memory pressure detected, level: $level")
        }
    }
}